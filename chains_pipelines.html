
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Cadenas de Algoritmos y Pipelines &#8212; Maestría en Estadística Aplicada</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Aprendizaje de maquinas no supervisado" href="unsupervised_learning.html" />
    <link rel="prev" title="Evaluación de modelos" href="model_evaluation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo-uninorte.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Maestría en Estadística Aplicada</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Machine Learning
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="dash_jbook.html">
   Introducción a
   <code class="docutils literal notranslate">
    <span class="pre">
     Dash
    </span>
   </code>
   y
   <code class="docutils literal notranslate">
    <span class="pre">
     Jupyter
    </span>
    <span class="pre">
     Book
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="supervised_learning.html">
   Aprendizaje supervisado
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="model_evaluation.html">
   Evaluación de modelos
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Cadenas de Algoritmos y Pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="unsupervised_learning.html">
   Aprendizaje de maquinas no supervisado
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/chains_pipelines.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchains_pipelines.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/chains_pipelines.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#seleccion-de-parametros-con-preprocesamiento">
   Selección de parámetros con preprocesamiento
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#construyendo-pipelines">
   Construyendo Pipelines
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#utilizando-pipeline-en-gridsearch">
   Utilizando Pipeline en GridSearch
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ilustracion-de-la-perdida-de-informacion">
   Ilustración de la pérdida de información
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#la-interfaz-general-del-pipeline">
   La interfaz general del Pipeline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creacion-comoda-de-pipelines-con-make-pipeline">
   Creación cómoda de pipelines con make_pipeline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acceso-a-los-atributos-de-los-pasos">
   Acceso a los atributos de los pasos
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acceso-a-los-atributos-en-un-pipeline-con-gridsearch">
   Acceso a los atributos en un Pipeline con GridSearch
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pasos-de-preprocesamiento-gridsearch-y-parametros-del-modelo">
   Pasos de preprocesamiento GridSearch y Parámetros del Modelo
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grid-searching-que-modelo-usar">
   Grid-Searching Qué Modelo Usar
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resumen-y-conclusiones">
   Resumen y conclusiones
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Cadenas de Algoritmos y Pipelines</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#seleccion-de-parametros-con-preprocesamiento">
   Selección de parámetros con preprocesamiento
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#construyendo-pipelines">
   Construyendo Pipelines
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#utilizando-pipeline-en-gridsearch">
   Utilizando Pipeline en GridSearch
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ilustracion-de-la-perdida-de-informacion">
   Ilustración de la pérdida de información
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#la-interfaz-general-del-pipeline">
   La interfaz general del Pipeline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creacion-comoda-de-pipelines-con-make-pipeline">
   Creación cómoda de pipelines con make_pipeline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acceso-a-los-atributos-de-los-pasos">
   Acceso a los atributos de los pasos
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acceso-a-los-atributos-en-un-pipeline-con-gridsearch">
   Acceso a los atributos en un Pipeline con GridSearch
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pasos-de-preprocesamiento-gridsearch-y-parametros-del-modelo">
   Pasos de preprocesamiento GridSearch y Parámetros del Modelo
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grid-searching-que-modelo-usar">
   Grid-Searching Qué Modelo Usar
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resumen-y-conclusiones">
   Resumen y conclusiones
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="cadenas-de-algoritmos-y-pipelines">
<h1>Cadenas de Algoritmos y Pipelines<a class="headerlink" href="#cadenas-de-algoritmos-y-pipelines" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>Para muchos algoritmos de aprendizaje automático, la representación particular de los datos que proporciona es muy importante, como ya comentamos anterioremente. Esto comienza con el escalado de los datos y la combinación de características a mano y llega hasta el aprendizaje de características utilizando el aprendizaje automático no supervisado. En consecuencia, <code class="docutils literal notranslate"><span class="pre">la</span> <span class="pre">mayoría</span> <span class="pre">de</span> <span class="pre">las</span> <span class="pre">aplicaciones</span> <span class="pre">de</span> <span class="pre">aprendizaje</span> <span class="pre">automático</span> <span class="pre">requieren</span> <span class="pre">no</span> <span class="pre">sólo</span> <span class="pre">la</span> <span class="pre">aplicación</span> <span class="pre">de</span> <span class="pre">un</span> <span class="pre">único</span> <span class="pre">algoritmo</span> <span class="pre">sino</span> <span class="pre">el</span> <span class="pre">encadenamiento</span> <span class="pre">de</span> <span class="pre">muchos</span> <span class="pre">pasos</span> <span class="pre">de</span> <span class="pre">procesamiento</span> <span class="pre">y</span> <span class="pre">modelos</span> <span class="pre">de</span> <span class="pre">aprendizaje</span> <span class="pre">automático</span> <span class="pre">diferentes</span></code>. En este capítulo, veremos cómo utilizar la clase <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> para simplificar el proceso de construcción de cadenas de transformaciones y modelos. En particular, veremos cómo podemos <code class="docutils literal notranslate"><span class="pre">combinar</span> <span class="pre">Pipeline</span> <span class="pre">y</span> <span class="pre">GridSearchCV</span> <span class="pre">para</span> <span class="pre">buscar</span> <span class="pre">sobre</span> <span class="pre">los</span> <span class="pre">parámetros</span> <span class="pre">de</span> <span class="pre">todos</span> <span class="pre">los</span> <span class="pre">pasos</span> <span class="pre">de</span> <span class="pre">procesamiento</span> <span class="pre">a</span> <span class="pre">la</span> <span class="pre">vez</span></code>. Como ejemplo de la importancia de encadenar modelos, observamos que podemos mejorar en gran medida el rendimiento de un kernel <code class="docutils literal notranslate"><span class="pre">SVM</span></code> en el conjunto de datos sobre el cáncer utilizando el <code class="docutils literal notranslate"><span class="pre">MinMaxScaler</span></code> para el preprocesamiento.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_breast_cancer</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cancer</span> <span class="o">=</span> <span class="n">load_breast_cancer</span><span class="p">()</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">cancer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cancer</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">svm</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">()</span>
<span class="n">svm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svm</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test score: 0.97
</pre></div>
</div>
</div>
</div>
<section id="seleccion-de-parametros-con-preprocesamiento">
<h2>Selección de parámetros con preprocesamiento<a class="headerlink" href="#seleccion-de-parametros-con-preprocesamiento" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Ahora digamos que queremos encontrar mejores parámetros para el <code class="docutils literal notranslate"><span class="pre">SVC</span></code> usando <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>, como se ha discutido en secciones anteriores. ¿Cómo podemos hacerlo? Un enfoque ingenuo podría ser el siguiente</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
              <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">SVC</span><span class="p">(),</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best cross-validation accuracy: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_score_</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters: &quot;</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best cross-validation accuracy: 0.98
Best set score: 0.97
Best parameters:  {&#39;C&#39;: 1, &#39;gamma&#39;: 1}
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>En este caso, ejecutamos una búsqueda en red (<code class="docutils literal notranslate"><span class="pre">grid-search</span></code>) sobre los parámetros de <code class="docutils literal notranslate"><span class="pre">SVC</span></code> utilizando los <code class="docutils literal notranslate"><span class="pre">datos</span> <span class="pre">escalados</span></code>. Sin embargo, nótese que al escalar los datos, <code class="docutils literal notranslate"><span class="pre">utilizamos</span> <span class="pre">todos</span> <span class="pre">los</span> <span class="pre">datos</span> <span class="pre">del</span> <span class="pre">conjunto</span> <span class="pre">de</span> <span class="pre">entrenamiento</span></code>. Luego usamos los <code class="docutils literal notranslate"><span class="pre">datos</span> <span class="pre">de</span> <span class="pre">entrenamiento</span> <span class="pre">escalados</span> <span class="pre">para</span> <span class="pre">ejecutar</span> <span class="pre">nuestra</span> <span class="pre">búsqueda</span> <span class="pre">en</span> <span class="pre">red</span> <span class="pre">usando</span> <span class="pre">la</span> <span class="pre">validación</span> <span class="pre">cruzada</span></code>. Para cada división en la validación cruzada, recuerde que, dependiendo del número de folds, en este caso por defecto <code class="docutils literal notranslate"><span class="pre">cv=5</span></code>, alguna parte del conjunto de entrenamiento original, será declarada como la parte de entrenamiento de la división, y otra la parte de prueba. <code class="docutils literal notranslate"><span class="pre">La</span> <span class="pre">parte</span> <span class="pre">de</span> <span class="pre">prueba</span> <span class="pre">se</span> <span class="pre">utiliza</span> <span class="pre">para</span> <span class="pre">medir</span> <span class="pre">cómo</span> <span class="pre">el</span> <span class="pre">modelo</span> <span class="pre">clasificará</span> <span class="pre">nuevos</span> <span class="pre">datos</span> <span class="pre">cuando</span> <span class="pre">fué</span> <span class="pre">entrenado</span> <span class="pre">con</span> <span class="pre">datos</span> <span class="pre">de</span> <span class="pre">entrenamiento</span></code>.</p></li>
<li><p>Recuerde que, la parte de prueba de cada división en la validación cruzada es parte del conjunto de entrenamiento, y utilizamos la información de todo el conjunto de entrenamiento para encontrar el escalado correcto de los datos. Esto es fundamentalmente diferente de cómo se ven los nuevos datos para el modelo. <code class="docutils literal notranslate"><span class="pre">Si</span> <span class="pre">observamos</span> <span class="pre">datos</span> <span class="pre">nuevos</span> <span class="pre">(por</span> <span class="pre">ejemplo,</span> <span class="pre">en</span> <span class="pre">forma</span> <span class="pre">de</span> <span class="pre">nuestro</span> <span class="pre">conjunto</span> <span class="pre">de</span> <span class="pre">prueba),</span> <span class="pre">estos</span> <span class="pre">datos</span> <span class="pre">no</span> <span class="pre">se</span> <span class="pre">habrán</span> <span class="pre">utilizado</span> <span class="pre">para</span> <span class="pre">escalar</span> <span class="pre">los</span> <span class="pre">datos</span> <span class="pre">de</span> <span class="pre">entrenamiento,</span> <span class="pre">y</span> <span class="pre">podrían</span> <span class="pre">tener</span> <span class="pre">un</span> <span class="pre">mínimo</span> <span class="pre">y</span> <span class="pre">un</span> <span class="pre">máximo</span> <span class="pre">diferente</span> <span class="pre">a</span> <span class="pre">los</span> <span class="pre">de</span> <span class="pre">los</span> <span class="pre">datos</span> <span class="pre">de</span> <span class="pre">entrenamiento</span></code>. El siguiente ejemplo muestra cómo se procesan los datos durante la la validación cruzada y la evaluación final</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mglearn</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mglearn</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_improper_processing</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chains_pipelines_12_0.png" src="_images/chains_pipelines_12_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Así, las divisiones en la validación cruzada ya no reflejan correctamente cómo se verán los nuevos datos en el proceso de modelamiento, ya que hemos filtrado información de estas partes de los datos en este proceso. Esto conducirá a resultados excesivamente optimistas durante la validación cruzada, y posiblemente, a la selección de parámetros subóptimos. <code class="docutils literal notranslate"><span class="pre">Para</span> <span class="pre">evitar</span> <span class="pre">este</span> <span class="pre">problema,</span> <span class="pre">la</span> <span class="pre">división</span> <span class="pre">del</span> <span class="pre">conjunto</span> <span class="pre">de</span> <span class="pre">datos</span> <span class="pre">durante</span> <span class="pre">la</span> <span class="pre">validación</span> <span class="pre">cruzada</span> <span class="pre">debería</span> <span class="pre">hacerse</span> <span class="pre">antes</span> <span class="pre">de</span> <span class="pre">realizar</span> <span class="pre">cualquier</span> <span class="pre">preprocesamiento</span></code>. Cualquier proceso que extraiga conocimiento del conjunto de datos sólo debe aplicarse a la parte de entrenamiento, por lo que cualquier validación cruzada debe ser el <code class="docutils literal notranslate"><span class="pre">&quot;bucle</span> <span class="pre">más</span> <span class="pre">externo&quot;</span></code> de su procesamiento.</p></li>
<li><p>Para lograr esto en <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> con la función <code class="docutils literal notranslate"><span class="pre">cross_val_score</span></code> y la función <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>, podemos utilizar la clase <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code>. La clase <code class="docutils literal notranslate"><span class="pre">Pipeline</span> <span class="pre">es</span> <span class="pre">una</span> <span class="pre">clase</span> <span class="pre">que</span> <span class="pre">permite</span> <span class="pre">&quot;pegar&quot;</span> <span class="pre">múltiples</span> <span class="pre">pasos</span> <span class="pre">de</span> <span class="pre">procesamiento</span> <span class="pre">en</span> <span class="pre">un</span> <span class="pre">único</span> <span class="pre">estimador</span> <span class="pre">de</span> <span class="pre">scikit-learn</span></code>. La clase <code class="docutils literal notranslate"><span class="pre">Pipeline</span> <span class="pre">tiene</span> <span class="pre">métodos</span> <span class="pre">de</span> <span class="pre">ajuste,</span> <span class="pre">predicción</span> <span class="pre">y</span> <span class="pre">scoring,</span> <span class="pre">además</span> <span class="pre">se</span> <span class="pre">comporta</span> <span class="pre">como</span> <span class="pre">cualquier</span> <span class="pre">otro</span> <span class="pre">modelo</span> <span class="pre">en</span> <span class="pre">scikit-learn</span></code>. El caso de uso más común de la clase <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> es encadenar pasos de preprocesamiento (como el escalado de los datos) junto con un modelo supervisado como un clasificador.</p></li>
</ul>
</section>
<section id="construyendo-pipelines">
<h2>Construyendo Pipelines<a class="headerlink" href="#construyendo-pipelines" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Veamos cómo podemos utilizar la clase <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> para expresar el flujo de trabajo para entrenar una <code class="docutils literal notranslate"><span class="pre">SVM</span></code> después de escalar los datos con <code class="docutils literal notranslate"><span class="pre">MinMaxScaler</span></code> (por ahora sin grid-search). Primero, <code class="docutils literal notranslate"><span class="pre">construimos</span> <span class="pre">un</span> <span class="pre">objeto</span> <span class="pre">pipeline</span> <span class="pre">proporcionándole</span> <span class="pre">una</span> <span class="pre">lista</span> <span class="pre">de</span> <span class="pre">pasos.</span> <span class="pre">Cada</span> <span class="pre">paso</span> <span class="pre">es</span> <span class="pre">una</span> <span class="pre">tupla</span> <span class="pre">que</span> <span class="pre">contiene</span> <span class="pre">un</span> <span class="pre">nombre</span> <span class="pre">(cualquier</span> <span class="pre">cadena</span> <span class="pre">de</span> <span class="pre">su</span> <span class="pre">elección)</span> <span class="pre">y</span> <span class="pre">una</span> <span class="pre">instancia</span> <span class="pre">de</span> <span class="pre">un</span> <span class="pre">estimador</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s2">&quot;svm&quot;</span><span class="p">,</span> <span class="n">SVC</span><span class="p">())])</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Aquí, creamos dos pasos: el primero, llamado <code class="docutils literal notranslate"><span class="pre">&quot;scaler&quot;,</span> <span class="pre">es</span> <span class="pre">una</span> <span class="pre">instancia</span> <span class="pre">de</span> <span class="pre">MinMaxScaler</span></code> y el segundo, llamado <code class="docutils literal notranslate"><span class="pre">&quot;svm&quot;,</span> <span class="pre">es</span> <span class="pre">una</span> <span class="pre">instancia</span> <span class="pre">de</span> <span class="pre">SVC</span></code>. Ahora, podemos ajustar nuestro pipeline, como cualquier otro estimador de <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pipeline(steps=[(&#39;scaler&#39;, MinMaxScaler()), (&#39;svm&#39;, SVC())])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Aquí, <code class="docutils literal notranslate"><span class="pre">pipe.fit</span></code> primero llama a <code class="docutils literal notranslate"><span class="pre">fit</span></code> en el primer paso (el escalador), luego transforma los datos de entrenamiento usando el escalador, y finalmente ajusta la <code class="docutils literal notranslate"><span class="pre">SVM</span></code> con los datos escalados. <code class="docutils literal notranslate"><span class="pre">Para</span> <span class="pre">evaluar</span> <span class="pre">en</span> <span class="pre">los</span> <span class="pre">datos</span> <span class="pre">de</span> <span class="pre">prueba,</span> <span class="pre">simplemente</span> <span class="pre">llamamos</span> <span class="pre">a</span> <span class="pre">pipe.score</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test score: 0.97
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Al llamar al método de scoring en el pipeline, primero se transforman los datos de prueba utilizando el <code class="docutils literal notranslate"><span class="pre">scaler</span></code> y luego llama al método de scoring en la <code class="docutils literal notranslate"><span class="pre">SVM</span></code> utilizando los datos de prueba escalados. Como puede, el resultado es idéntico al que obtuvimos del código al principio del
capítulo, al hacer las transformaciones a mano. <code class="docutils literal notranslate"><span class="pre">Usando</span> <span class="pre">el</span> <span class="pre">pipeline,</span> <span class="pre">hemos</span> <span class="pre">reducido</span> <span class="pre">el</span> <span class="pre">código</span> <span class="pre">necesario</span> <span class="pre">para</span> <span class="pre">nuestro</span> <span class="pre">proceso</span> <span class="pre">de</span> <span class="pre">&quot;preprocesamiento</span> <span class="pre">+</span> <span class="pre">clasificación&quot;</span></code>. Sin embargo, la principal ventaja de usar el <code class="docutils literal notranslate"><span class="pre">pipeline</span></code>, es que ahora podemos usar este único estimador en
<code class="docutils literal notranslate"><span class="pre">cross_val_score</span></code> o <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>.</p></li>
</ul>
</section>
<section id="utilizando-pipeline-en-gridsearch">
<h2>Utilizando Pipeline en GridSearch<a class="headerlink" href="#utilizando-pipeline-en-gridsearch" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>El uso de una tubería <code class="docutils literal notranslate"><span class="pre">(pipeline)</span></code> en una búsqueda de red <code class="docutils literal notranslate"><span class="pre">(grid-search)</span></code> funciona de la misma manera que el uso de cualquier otro estimador. <code class="docutils literal notranslate"><span class="pre">Definimos</span> <span class="pre">una</span> <span class="pre">red</span> <span class="pre">de</span> <span class="pre">parámetros</span> <span class="pre">en</span> <span class="pre">la</span> <span class="pre">que</span> <span class="pre">buscar,</span> <span class="pre">y</span> <span class="pre">construimos</span> <span class="pre">un</span> <span class="pre">GridSearchCV</span> <span class="pre">a</span> <span class="pre">partir</span> <span class="pre">de</span> <span class="pre">la</span> <span class="pre">tubería</span> <span class="pre">y</span> <span class="pre">la</span> <span class="pre">red</span> <span class="pre">de</span> <span class="pre">parámetros</span></code>. Al especificar la red de parámetros, hay un ligero cambio, sin embargo. Tenemos que especificar para cada parámetro, a qué paso de la tubería pertenece. Los dos parámetros que queremos ajustar, <code class="docutils literal notranslate"><span class="pre">C</span></code> y <code class="docutils literal notranslate"><span class="pre">gamma</span></code>, son parámetros de <code class="docutils literal notranslate"><span class="pre">SVC</span></code>, el segundo paso. A este paso le hemos dado el nombre de <code class="docutils literal notranslate"><span class="pre">&quot;svm&quot;</span></code>. La sintaxis para definir una red de parámetros para una tubería es especificar, para cada parámetro, el nombre del paso, seguido de <code class="docutils literal notranslate"><span class="pre">__</span></code> (un doble guión bajo), seguido del nombre del parámetro. <code class="docutils literal notranslate"><span class="pre">Para</span> <span class="pre">buscar</span> <span class="pre">en</span> <span class="pre">los</span> <span class="pre">parámetros</span> <span class="pre">de</span> <span class="pre">C</span> <span class="pre">de</span> <span class="pre">SVC</span> <span class="pre">tenemos</span> <span class="pre">que</span> <span class="pre">usar</span> <span class="pre">&quot;svm__C&quot;</span> <span class="pre">como</span> <span class="pre">clave</span> <span class="pre">en</span> <span class="pre">el</span> <span class="pre">diccionario</span> <span class="pre">de</span> <span class="pre">la</span> <span class="pre">red</span> <span class="pre">de</span> <span class="pre">parámetros,</span> <span class="pre">y</span> <span class="pre">lo</span> <span class="pre">mismo</span> <span class="pre">para</span> <span class="pre">gamma</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;svm__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> 
              <span class="s1">&#39;svm__gamma&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Con este parámetro <code class="docutils literal notranslate"><span class="pre">grid</span></code> podemos utilizar <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> como siempre</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best cross-validation accuracy: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_score_</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_params_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best cross-validation accuracy: 0.98
Test set score: 0.97
Best parameters: {&#39;svm__C&#39;: 1, &#39;svm__gamma&#39;: 1}
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>A diferencia de la búsqueda en red que hicimos antes, ahora <code class="docutils literal notranslate"><span class="pre">para</span> <span class="pre">cada</span> <span class="pre">división</span> <span class="pre">en</span> <span class="pre">la</span> <span class="pre">validación</span> <span class="pre">cruzada</span> <span class="pre">el</span> <span class="pre">MinMaxScaler</span> <span class="pre">se</span> <span class="pre">reajusta</span> <span class="pre">sólo</span> <span class="pre">con</span> <span class="pre">las</span> <span class="pre">divisiones</span> <span class="pre">de</span> <span class="pre">entrenamiento</span> <span class="pre">y</span> <span class="pre">no</span> <span class="pre">se</span> <span class="pre">filtra</span> <span class="pre">información</span> <span class="pre">de</span> <span class="pre">la</span> <span class="pre">división</span> <span class="pre">de</span> <span class="pre">prueba</span> <span class="pre">en</span> <span class="pre">la</span> <span class="pre">búsqueda</span> <span class="pre">de</span> <span class="pre">parámetros</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mglearn</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_proper_processing</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chains_pipelines_29_0.png" src="_images/chains_pipelines_29_0.png" />
</div>
</div>
<ul class="simple">
<li><p>El impacto de la fuga de información en la validación cruzada varía en función de la naturaleza del paso de preprocesamiento. <code class="docutils literal notranslate"><span class="pre">La</span> <span class="pre">estimación</span> <span class="pre">de</span> <span class="pre">la</span> <span class="pre">escala</span> <span class="pre">de</span> <span class="pre">los</span> <span class="pre">datos</span> <span class="pre">mediante</span> <span class="pre">el</span> <span class="pre">pliegue</span> <span class="pre">de</span> <span class="pre">prueba</span> <span class="pre">no</span> <span class="pre">suele</span> <span class="pre">tener</span> <span class="pre">un</span> <span class="pre">impacto</span> <span class="pre">terrible,</span> <span class="pre">mientras</span> <span class="pre">que,</span> <span class="pre">el</span> <span class="pre">uso</span> <span class="pre">del</span> <span class="pre">pliegue</span> <span class="pre">de</span> <span class="pre">prueba</span> <span class="pre">en</span> <span class="pre">la</span> <span class="pre">extracción</span> <span class="pre">de</span> <span class="pre">características</span> <span class="pre">y</span> <span class="pre">la</span> <span class="pre">selección</span> <span class="pre">de</span> <span class="pre">características</span> <span class="pre">puede</span> <span class="pre">dar</span> <span class="pre">lugar</span> <span class="pre">a</span> <span class="pre">diferencias</span> <span class="pre">sustanciales</span> <span class="pre">en</span> <span class="pre">los</span> <span class="pre">resultados</span></code>.</p></li>
</ul>
</section>
<section id="ilustracion-de-la-perdida-de-informacion">
<h2>Ilustración de la pérdida de información<a class="headerlink" href="#ilustracion-de-la-perdida-de-informacion" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Un gran ejemplo de fuga de información en la validación cruzada se da en el libro de <em><code class="docutils literal notranslate"><span class="pre">Hastie,</span> <span class="pre">Tibshirani</span> <span class="pre">y</span> <span class="pre">Friedman:</span> <span class="pre">The</span> <span class="pre">Elements</span> <span class="pre">of</span> <span class="pre">Statistical</span> <span class="pre">Learning</span></code></em>, y aquí reproducimos una versión adaptada. Consideremos una tarea de regresión sintética con 100 muestras y 1.000 características que se muestrean independientemente de una distribución gaussiana. También muestreamos la respuesta a partir de una distribución gaussiana</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rnd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">rnd</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">rnd</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,))</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Dada la forma en que creamos el conjunto de datos, <code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">hay</span> <span class="pre">relación</span> <span class="pre">entre</span> <span class="pre">los</span> <span class="pre">datos,</span> <span class="pre">X,</span> <span class="pre">y</span> <span class="pre">el</span> <span class="pre">objetivo,</span> <span class="pre">y</span> <span class="pre">(son</span> <span class="pre">independientes),</span> <span class="pre">por</span> <span class="pre">lo</span> <span class="pre">que</span> <span class="pre">no</span> <span class="pre">debería</span> <span class="pre">ser</span> <span class="pre">posible</span> <span class="pre">aprender</span> <span class="pre">nada</span> <span class="pre">de</span> <span class="pre">este</span> <span class="pre">conjunto</span> <span class="pre">de</span> <span class="pre">datos</span></code>. Ahora haremos lo siguiente. En primer lugar, seleccionamos la más informativa de las 10 características utilizando la selección de características <code class="docutils literal notranslate"><span class="pre">SelectPercentile</span> <span class="pre">(selecciona</span> <span class="pre">variables</span> <span class="pre">independientes</span> <span class="pre">que</span> <span class="pre">están</span> <span class="pre">en</span> <span class="pre">el</span> <span class="pre">percentil</span> <span class="pre">de</span> <span class="pre">scores</span> <span class="pre">más</span> <span class="pre">altos)</span></code>, y luego evaluamos un regresor <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> utilizando la validación cruzada</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectPercentile</span><span class="p">,</span> <span class="n">f_regression</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">=</span> <span class="n">SelectPercentile</span><span class="p">(</span><span class="n">score_func</span><span class="o">=</span><span class="n">f_regression</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">X_selected</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X_selected.shape: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">X_selected</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X_selected.shape: (100, 500)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-validation accuracy (cv only on ridge): </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">X_selected</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">))))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cross-validation accuracy (cv only on ridge): 0.91
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">El</span></code> <span class="math notranslate nohighlight">\(R^2\)</span> <code class="docutils literal notranslate"><span class="pre">medio</span> <span class="pre">calculado</span> <span class="pre">por</span> <span class="pre">validación</span> <span class="pre">cruzada</span> <span class="pre">es</span> <span class="pre">de</span> <span class="pre">0.91,</span> <span class="pre">lo</span> <span class="pre">que</span> <span class="pre">indica</span> <span class="pre">un</span> <span class="pre">modelo</span> <span class="pre">muy</span> <span class="pre">bueno.</span> <span class="pre">Está</span> <span class="pre">claro</span> <span class="pre">que</span> <span class="pre">esto</span> <span class="pre">no</span> <span class="pre">puede</span> <span class="pre">ser</span> <span class="pre">correcto,</span> <span class="pre">ya</span> <span class="pre">que</span> <span class="pre">nuestros</span> <span class="pre">datos</span> <span class="pre">son</span> <span class="pre">totalmente</span> <span class="pre">aleatorios</span></code>. Lo que ocurrió aquí es que nuestra selección de características escogió algunas características entre las 10.000 características aleatorias que están (por casualidad) muy bien correlacionadas con el objetivo. <code class="docutils literal notranslate"><span class="pre">Dado</span> <span class="pre">que</span> <span class="pre">ajustamos</span> <span class="pre">la</span> <span class="pre">selección</span> <span class="pre">de</span> <span class="pre">características</span> <span class="pre">fuera</span> <span class="pre">de</span> <span class="pre">la</span> <span class="pre">validación</span> <span class="pre">cruzada,</span> <span class="pre">podría</span> <span class="pre">encontrar</span> <span class="pre">características</span> <span class="pre">que</span> <span class="pre">están</span> <span class="pre">correlacionadas</span> <span class="pre">tanto</span> <span class="pre">en</span> <span class="pre">los</span> <span class="pre">pliegues</span> <span class="pre">de</span> <span class="pre">entrenamiento</span> <span class="pre">y</span> <span class="pre">de</span> <span class="pre">prueba</span></code>. La información que filtramos de los pliegues de prueba fue muy informativa, conduciendo a resultados muy poco realistas. Comparemos esto con una adecuada validación cruzada usando una tubería</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="n">SelectPercentile</span><span class="p">(</span><span class="n">score_func</span><span class="o">=</span><span class="n">f_regression</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="mi">5</span><span class="p">)),</span> 
                 <span class="p">(</span><span class="s2">&quot;ridge&quot;</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-validation accuracy (pipeline): </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">))))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cross-validation accuracy (pipeline): -0.25
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Esta vez, obtenemos una puntuación <span class="math notranslate nohighlight">\(R^2\)</span> negativa, lo que indica un modelo muy pobre. <code class="docutils literal notranslate"><span class="pre">Utilizando</span> <span class="pre">Pipeline,</span> <span class="pre">la</span> <span class="pre">línea</span> <span class="pre">de</span> <span class="pre">selección</span> <span class="pre">de</span> <span class="pre">características</span> <span class="pre">está</span> <span class="pre">ahora</span> <span class="pre">dentro</span> <span class="pre">del</span> <span class="pre">bucle</span> <span class="pre">de</span> <span class="pre">validación</span> <span class="pre">cruzada.</span> <span class="pre">Esto</span> <span class="pre">significa</span> <span class="pre">que</span> <span class="pre">las</span> <span class="pre">características</span> <span class="pre">sólo</span> <span class="pre">pueden</span> <span class="pre">seleccionarse</span> <span class="pre">utilizando</span> <span class="pre">los</span> <span class="pre">pliegues</span> <span class="pre">de</span> <span class="pre">entrenamiento</span> <span class="pre">de</span> <span class="pre">los</span> <span class="pre">datos,</span> <span class="pre">no</span> <span class="pre">el</span> <span class="pre">pliegue</span> <span class="pre">de</span> <span class="pre">prueba</span></code>. La selección de características encuentra características que están correlacionadas con el objetivo en el conjunto de entrenamiento, pero como los datos son totalmente aleatorios, estas características no están correlacionadas con el objetivo en el conjunto de prueba. En este ejemplo, podemos rectificar que, el problema de fuga de datos en la selección de características, marca la diferencia entre concluir que un modelo funciona muy bien y concluir que un modelo no funciona en absoluto.</p></li>
</ul>
</section>
<section id="la-interfaz-general-del-pipeline">
<h2>La interfaz general del Pipeline<a class="headerlink" href="#la-interfaz-general-del-pipeline" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>La clase <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> no se limita al preprocesamiento y la clasificación, sino que puede unir cualquier número de estimadores. Por ejemplo, se puede construir una tubería que contenga la <code class="docutils literal notranslate"><span class="pre">extracción</span> <span class="pre">de</span> <span class="pre">características,</span> <span class="pre">la</span> <span class="pre">selección</span> <span class="pre">de</span> <span class="pre">características,</span> <span class="pre">el</span> <span class="pre">escalado</span> <span class="pre">y</span> <span class="pre">la</span> <span class="pre">clasificación</span></code>, para un total de cuatro pasos. Del mismo modo, el último paso podría ser la regresión o la agrupación en lugar de la clasificación. El único requisito para los estimadores en una línea de producción es que <code class="docutils literal notranslate"><span class="pre">todos</span> <span class="pre">los</span> <span class="pre">pasos,</span> <span class="pre">excepto</span> <span class="pre">el</span> <span class="pre">último,</span> <span class="pre">deben</span> <span class="pre">tener</span> <span class="pre">un</span> <span class="pre">método</span> <span class="pre">de</span> <span class="pre">transformación,</span> <span class="pre">de</span> <span class="pre">modo</span> <span class="pre">que</span> <span class="pre">puedan</span> <span class="pre">ser</span> <span class="pre">utilizados</span> <span class="pre">en</span> <span class="pre">el</span> <span class="pre">siguiente</span> <span class="pre">paso</span></code>.</p></li>
<li><p>Internamente, durante la llamada a <code class="docutils literal notranslate"><span class="pre">Pipeline.fit</span></code>, la tubería llama a <code class="docutils literal notranslate"><span class="pre">fit</span></code> y luego a <code class="docutils literal notranslate"><span class="pre">transform</span></code> en cada paso, con la entrada dada por la salida del método de transformación del paso anterior. Para el último paso de la tubería, sólo se llama a fit. Repasando algunos detalles más finos, esto se implementa como sigue. Recuerde que la tubería <code class="docutils literal notranslate"><span class="pre">line.steps</span></code> es una lista de tuplas, por lo que <code class="docutils literal notranslate"><span class="pre">pipeline.steps[0][1]</span></code> es el primer estimador, <code class="docutils literal notranslate"><span class="pre">pipeline.steps[1][1]</span></code> es el segundo estimador, y así sucesivamente</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">X_transformed</span> <span class="o">=</span> <span class="n">X</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># Iterar sobre todo excepto el último paso </span>
        <span class="c1"># Ajustar y transformar los datos</span>
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="c1"># Ajuste en el último paso</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Cuando se predice utilizando <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code>, transformamos los datos de forma similar utilizando todos los pasos menos el último paso, y luego llamamos a <code class="docutils literal notranslate"><span class="pre">predict</span></code> en el último paso</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="n">X_transformed</span> <span class="o">=</span> <span class="n">X</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># Iterar sobre todo excepto el último paso </span>
        <span class="c1"># Ajustar y transformar los datos</span>
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="n">step</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">)</span>
    <span class="c1"># Ajuste en el último paso</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>El proceso se ilustra en la <a class="reference internal" href="#pipeline-predict"><span class="std std-numref">Fig. 30</span></a> para dos transformadores, <code class="docutils literal notranslate"><span class="pre">T1</span></code>, <code class="docutils literal notranslate"><span class="pre">T2</span></code>, y un <code class="docutils literal notranslate"><span class="pre">classifier</span></code> (llamado <code class="docutils literal notranslate"><span class="pre">Classifier</span></code>)</p></li>
</ul>
<figure class="align-center" id="pipeline-predict">
<a class="reference internal image-reference" href="_images/pipeline_predict.png"><img alt="_images/pipeline_predict.png" src="_images/pipeline_predict.png" style="width: 625.1999999999999px; height: 445.8px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 30 </span><span class="caption-text">Visión general del proceso de entrenamiento y predicción de la tubería.</span><a class="headerlink" href="#pipeline-predict" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>En realidad, la tubería es aún más general que esto. No es necesario que el último paso de una tubería tenga una función de predicción, y <code class="docutils literal notranslate"><span class="pre">podríamos</span> <span class="pre">crear</span> <span class="pre">una</span> <span class="pre">tubería</span> <span class="pre">que</span> <span class="pre">sólo</span> <span class="pre">contenga,</span> <span class="pre">por</span> <span class="pre">ejemplo,</span> <span class="pre">un</span> <span class="pre">escalador</span> <span class="pre">y</span> <span class="pre">un</span> <span class="pre">PCA</span></code>. Entonces, como el último paso <code class="docutils literal notranslate"><span class="pre">(PCA)</span></code> tiene un método <code class="docutils literal notranslate"><span class="pre">transform</span></code>, podríamos llamar a <code class="docutils literal notranslate"><span class="pre">transform</span></code> en el <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> para obtener el resultado de <code class="docutils literal notranslate"><span class="pre">PCA.transform</span></code> aplicado a los datos que fueron procesados por el paso anterior. Sólo se requiere que el último paso de un pipeline tenga un método de ajuste.</p></li>
</ul>
</section>
<section id="creacion-comoda-de-pipelines-con-make-pipeline">
<h2>Creación cómoda de pipelines con make_pipeline<a class="headerlink" href="#creacion-comoda-de-pipelines-con-make-pipeline" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>La creación de un <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> utilizando la sintaxis descrita anteriormente es a veces un poco engorrosa, y a menudo no necesitamos nombres especificados por el usuario para cada paso. <code class="docutils literal notranslate"><span class="pre">Existe</span> <span class="pre">una</span> <span class="pre">función</span> <span class="pre">conveniente</span> <span class="pre">make_pipeline,</span> <span class="pre">que</span> <span class="pre">creará</span> <span class="pre">una</span> <span class="pre">tubería</span> <span class="pre">por</span> <span class="pre">nosotros</span> <span class="pre">y</span> <span class="pre">nombrará</span> <span class="pre">automáticamente</span> <span class="pre">cada</span> <span class="pre">paso</span> <span class="pre">basándose</span> <span class="pre">en</span> <span class="pre">su</span> <span class="pre">clase</span></code>. La sintaxis de <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code> es la siguiente</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_long</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s2">&quot;svm&quot;</span><span class="p">,</span> <span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mi">100</span><span class="p">))])</span>
<span class="n">pipe_short</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Los objetos pipeline <code class="docutils literal notranslate"><span class="pre">pipe_long</span></code> y <code class="docutils literal notranslate"><span class="pre">pipe_short</span></code> hacen exactamente lo mismo, pero <code class="docutils literal notranslate"><span class="pre">pipe_short</span></code> tiene pasos que fueron nombrados automáticamente. Podemos ver los nombres de los pasos mirando el atributo <code class="docutils literal notranslate"><span class="pre">steps</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pipeline steps:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe_short</span><span class="o">.</span><span class="n">steps</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pipeline steps:
[(&#39;minmaxscaler&#39;, MinMaxScaler()), (&#39;svc&#39;, SVC(C=100))]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Los pasos se denominan <code class="docutils literal notranslate"><span class="pre">minmaxscaler</span></code> y <code class="docutils literal notranslate"><span class="pre">svc</span></code>. En general, los nombres de los pasos son sólo versiones de los nombres de las clases. Si varios pasos tienen la misma clase, se añade un número</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pipeline steps:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pipeline steps:
[(&#39;standardscaler-1&#39;, StandardScaler()), (&#39;pca&#39;, PCA(n_components=2)), (&#39;standardscaler-2&#39;, StandardScaler())]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Como puede ver, el primer paso de <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> llamó <code class="docutils literal notranslate"><span class="pre">standardscaler-1</span></code> y el segundo <code class="docutils literal notranslate"><span class="pre">standardscaler-2</span></code>. Sin embargo, en este tipo de configuraciones podría ser mejor utilizar la construcción de tuberías con nombres explícitos, para dar nombres más semánticos a cada paso</p></li>
</ul>
</section>
<section id="acceso-a-los-atributos-de-los-pasos">
<h2>Acceso a los atributos de los pasos<a class="headerlink" href="#acceso-a-los-atributos-de-los-pasos" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>A menudo querrá inspeccionar los atributos de uno de los pasos de la tubería, por ejemplo, los coeficientes de un modelo lineal o los componentes extraídos por <code class="docutils literal notranslate"><span class="pre">PCA</span></code>. <code class="docutils literal notranslate"><span class="pre">La</span> <span class="pre">forma</span> <span class="pre">más</span> <span class="pre">fácil</span> <span class="pre">de</span> <span class="pre">acceder</span> <span class="pre">a</span> <span class="pre">los</span> <span class="pre">pasos</span> <span class="pre">de</span> <span class="pre">un</span> <span class="pre">pipeline</span> <span class="pre">es</span> <span class="pre">a</span> <span class="pre">través</span> <span class="pre">del</span> <span class="pre">atributo</span> <span class="pre">named_steps</span></code>, que es un diccionario de los nombres de los pasos a los estimadores. - A continuación, se ajusta el <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> definido anteriormente, al conjunto de datos <code class="docutils literal notranslate"><span class="pre">cancer</span></code> y extrae las dos primeros componentes principales del paso <code class="docutils literal notranslate"><span class="pre">pca</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cancer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">components</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;pca&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">components_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;components.shape: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">components</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>components.shape: (2, 30)
</pre></div>
</div>
</div>
</div>
</section>
<section id="acceso-a-los-atributos-en-un-pipeline-con-gridsearch">
<h2>Acceso a los atributos en un Pipeline con GridSearch<a class="headerlink" href="#acceso-a-los-atributos-en-un-pipeline-con-gridsearch" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Como hemos comentado anteriormente en este capítulo, una de las principales razones para utilizar <code class="docutils literal notranslate"><span class="pre">pipelines</span></code>, es para realizar búsquedas en la red. Una tarea común es acceder a algunos de los pasos de una tubería dentro de dentro de una búsqueda en red. Busquemos en la red un clasificador <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> en el conjunto de datos de <code class="docutils literal notranslate"><span class="pre">cancer</span></code>, utilizando <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> y <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> para escalar los datos antes de pasarlos al clasificador <code class="docutils literal notranslate"><span class="pre">LogisticRegresión</span></code>. Primero creamos un pipeline usando la función <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">LogisticRegression</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>A continuación, creamos una cuadrícula de parámetros. Como se explica en la sección anterior, el parámetro de regularización para <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> es el parámetro <code class="docutils literal notranslate"><span class="pre">C</span></code>. Utilizamos una red logarítmica para este parámetro, buscando entre 0.01 y 100. Como utilizamos la función <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code>, el nombre del paso <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> en el <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> es el nombre de la clase en minúsculas, <code class="docutils literal notranslate"><span class="pre">logisticregression</span></code>. Para afinar el parámetro <code class="docutils literal notranslate"><span class="pre">C</span></code>, tenemos que especificar una red de parámetros para <code class="docutils literal notranslate"><span class="pre">logisticregression__C</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;logisticregression__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Como es habitual, dividimos el conjunto de datos sobre el cáncer en conjuntos de entrenamiento y de prueba, y ajustamos una búsqueda en red</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">cancer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cancer</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                                       (&#39;logisticregression&#39;,
                                        LogisticRegression())]),
             param_grid={&#39;logisticregression__C&#39;: [0.01, 0.1, 1, 10, 100]})
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Entonces, ¿cómo accedemos a los coeficientes del mejor modelo <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> que fue encontrado por <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>? De los capítulos anteriores sabemos que el mejor modelo encontrado por <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>, entrenado con todos los datos de entrenamiento, se almacena en <code class="docutils literal notranslate"><span class="pre">grid.best_estimator_</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;logisticregression&#39;, LogisticRegression(C=1))])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Este <code class="docutils literal notranslate"><span class="pre">best_estimator_</span></code> en nuestro caso es un <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> con dos pasos, <code class="docutils literal notranslate"><span class="pre">standardcaler</span></code> y <code class="docutils literal notranslate"><span class="pre">logisticregression</span></code>. Para acceder al paso de <code class="docutils literal notranslate"><span class="pre">logisticregression</span></code>, podemos utilizar el atributo <code class="docutils literal notranslate"><span class="pre">named_steps</span></code> de la tubería, como se ha explicado anteriormente</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Logistic regression step:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;logisticregression&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Logistic regression step:
LogisticRegression(C=1)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ahora que tenemos la instancia de <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> entrenada, podemos acceder a los coeficientes (pesos) asociados a cada característica de entrada.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Logistic regression coefficients:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;logisticregression&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Logistic regression coefficients:
[[-0.43570655 -0.34266946 -0.40809443 -0.5344574  -0.14971847  0.61034122
  -0.72634347 -0.78538827  0.03886087  0.27497198 -1.29780109  0.04926005
  -0.67336941 -0.93447426 -0.13939555  0.45032641 -0.13009864 -0.10144273
   0.43432027  0.71596578 -1.09068862 -1.09463976 -0.85183755 -1.06406198
  -0.74316099  0.07252425 -0.82323903 -0.65321239 -0.64379499 -0.42026013]]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Puede que sea una expresión algo larga, pero a menudo resulta útil para entender los modelos.</p></li>
</ul>
</section>
<section id="pasos-de-preprocesamiento-gridsearch-y-parametros-del-modelo">
<h2>Pasos de preprocesamiento GridSearch y Parámetros del Modelo<a class="headerlink" href="#pasos-de-preprocesamiento-gridsearch-y-parametros-del-modelo" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Usando <code class="docutils literal notranslate"><span class="pre">pipelines</span></code>, podemos encapsular todos los pasos de procesamiento en nuestro flujo de trabajo de aprendizaje automático en un único estimador de <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>. Otro beneficio de hacer esto es que ahora podemos <code class="docutils literal notranslate"><span class="pre">ajustar</span> <span class="pre">los</span> <span class="pre">parámetros</span> <span class="pre">de</span> <span class="pre">preprocesamiento</span></code> usando el output de una tarea supervisada, como la regresión o la clasificación. En los capítulos anteriores, utilizamos las funciones polinómicas en el dataset <code class="docutils literal notranslate"><span class="pre">boston</span></code> antes de aplicar el <code class="docutils literal notranslate"><span class="pre">regresor</span> <span class="pre">ridge</span></code>. Vamos a modelar esto usando un pipeline en su lugar. El proceso contiene tres pasos: <code class="docutils literal notranslate"><span class="pre">escalar</span> <span class="pre">los</span> <span class="pre">datos,</span> <span class="pre">calcular</span> <span class="pre">las</span> <span class="pre">características</span> <span class="pre">polinómicas</span> <span class="pre">y</span> <span class="pre">la</span> <span class="pre">regresión</span> <span class="pre">ridge</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_boston</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boston</span> <span class="o">=</span> <span class="n">load_boston</span><span class="p">()</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">boston</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">boston</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">PolynomialFeatures</span><span class="p">(),</span> <span class="n">Ridge</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>¿Cómo sabemos qué grados de polinomios elegir, o si hay que elegir algún polinomio o interacciones? <code class="docutils literal notranslate"><span class="pre">Lo</span> <span class="pre">ideal</span> <span class="pre">es</span> <span class="pre">seleccionar</span> <span class="pre">el</span> <span class="pre">parámetro</span> <span class="pre">de</span> <span class="pre">grado</span> <span class="pre">basado</span> <span class="pre">en</span> <span class="pre">el</span> <span class="pre">resultado</span> <span class="pre">de</span> <span class="pre">la</span> <span class="pre">clasificación</span></code>. Utilizando nuestro pipeline, podemos buscar sobre el parámetro <code class="docutils literal notranslate"><span class="pre">degree</span></code> junto con el parámetro <code class="docutils literal notranslate"><span class="pre">alpha</span></code> de <code class="docutils literal notranslate"><span class="pre">Ridge</span></code>. Para ello, definimos un <code class="docutils literal notranslate"><span class="pre">param_grid</span></code> que contenga ambos, debidamente prefijados por los nombres de los pasos</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;polynomialfeatures__degree&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> 
              <span class="s1">&#39;ridge__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ahora podemos volver a ejecutar nuestra búsqueda en la red</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                                       (&#39;polynomialfeatures&#39;,
                                        PolynomialFeatures()),
                                       (&#39;ridge&#39;, Ridge())]),
             n_jobs=-1,
             param_grid={&#39;polynomialfeatures__degree&#39;: [1, 2, 3],
                         &#39;ridge__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100]})
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Podemos visualizar el resultado de la validación cruzada utilizando un mapa de calor, como ya se hizo anteriormente</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;ridge__alpha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;polynomialfeatures__degree&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;ridge__alpha&#39;</span><span class="p">])),</span> <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;ridge__alpha&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;polynomialfeatures__degree&#39;</span><span class="p">])),</span>
<span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;polynomialfeatures__degree&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x293c6abf3d0&gt;
</pre></div>
</div>
<img alt="_images/chains_pipelines_91_1.png" src="_images/chains_pipelines_91_1.png" />
</div>
</div>
<ul class="simple">
<li><p>Observando los resultados producidos por la validación cruzada, <code class="docutils literal notranslate"><span class="pre">podemos</span> <span class="pre">ver</span> <span class="pre">que</span> <span class="pre">el</span> <span class="pre">uso</span> <span class="pre">de</span> <span class="pre">polinomios</span> <span class="pre">de</span> <span class="pre">grado</span> <span class="pre">dos</span> <span class="pre">ayuda,</span> <span class="pre">pero</span> <span class="pre">que</span> <span class="pre">los</span> <span class="pre">polinomios</span> <span class="pre">de</span> <span class="pre">grado</span> <span class="pre">tres</span> <span class="pre">son</span> <span class="pre">mucho</span> <span class="pre">peores</span> <span class="pre">que</span> <span class="pre">los</span> <span class="pre">de</span> <span class="pre">grado</span> <span class="pre">uno</span> <span class="pre">o</span> <span class="pre">dos</span></code>. Esto se refleja en los mejores parámetros encontrados</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_params_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best parameters: {&#39;polynomialfeatures__degree&#39;: 2, &#39;ridge__alpha&#39;: 10}
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Lo que lleva al siguiente score</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test-set score: 0.77
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Hagamos una búsqueda en red sin características polinómicas para comparar</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ridge__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">Ridge</span><span class="p">())</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Score without poly features: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Score without poly features: 0.63
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Como era de esperar al ver los resultados de la búsqueda en red visualizados, <code class="docutils literal notranslate"><span class="pre">el</span> <span class="pre">no</span> <span class="pre">uso</span> <span class="pre">de</span> <span class="pre">características</span> <span class="pre">polinómicas</span> <span class="pre">conduce</span> <span class="pre">a</span> <span class="pre">resultados</span> <span class="pre">decididamente</span> <span class="pre">peores.</span> <span class="pre">La</span> <span class="pre">búsqueda</span> <span class="pre">sobre</span> <span class="pre">los</span> <span class="pre">parámetros</span> <span class="pre">de</span> <span class="pre">preprocesamiento</span> <span class="pre">junto</span> <span class="pre">con</span> <span class="pre">los</span> <span class="pre">parámetros</span> <span class="pre">del</span> <span class="pre">modelo</span> <span class="pre">es</span> <span class="pre">una</span> <span class="pre">estrategia</span> <span class="pre">muy</span> <span class="pre">poderosa</span></code>. Sin embargo, hay que tener en cuenta que <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> prueba todas las combinaciones posibles de los parámetros especificados. Por lo tanto, si se añaden más parámetros a la red aumenta exponencialmente el número de modelos que hay que construir</p></li>
</ul>
</section>
<section id="grid-searching-que-modelo-usar">
<h2>Grid-Searching Qué Modelo Usar<a class="headerlink" href="#grid-searching-que-modelo-usar" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Se puede ir más allá al combinar <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> y <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code>: también es posible buscar sobre los pasos reales que se están realizando en el <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> (por ejemplo, si se debe utilizar <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> o <code class="docutils literal notranslate"><span class="pre">MinMaxScaler</span></code>). Esto conduce a un espacio de búsqueda aún mayor y debe considerarse cuidadosamente. Probar todas las soluciones posibles no suele ser una estrategia viable de aprendizaje automático. Sin embargo, aquí hay un ejemplo que compara un clasificador <code class="docutils literal notranslate"><span class="pre">RandomForest</span></code> y un <code class="docutils literal notranslate"><span class="pre">SVC</span></code> en el conjunto de datos <code class="docutils literal notranslate"><span class="pre">iris</span></code>. Sabemos que <code class="docutils literal notranslate"><span class="pre">SVC</span></code> podría necesitar que los datos sean escalados, por lo que también buscamos si se utiliza <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> o no preprocesamiento. Para el <code class="docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code>, sabemos que no es necesario el preprocesamiento. Comenzamos definiendo el <code class="docutils literal notranslate"><span class="pre">pipeline</span></code>. Aquí, nombramos explícitamente los pasos. Queremos dos pasos, uno para el preprocesamiento y luego un clasificador. Podemos instanciar esto utilizando <code class="docutils literal notranslate"><span class="pre">SVC</span></code> y <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">SVC</span><span class="p">())])</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ahora podemos definir el <code class="docutils literal notranslate"><span class="pre">parameter_grid</span></code> para buscar sobre él. Queremos que el clasificador sea <code class="docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code> o <code class="docutils literal notranslate"><span class="pre">SVC</span></code>. Debido a que tienen diferentes parámetros y necesitan un preprocesamiento diferente, podemos utilizar la lista de cuadrículas de búsqueda que que discutimos en el capítulo anterior. Para asignar una estimación a un paso, utilizamos el nombre del paso como nombre del parámetro. Cuando queramos omitir un paso en la tubería (por ejemplo, porque no necesitamos el preprocesamiento para el <code class="docutils literal notranslate"><span class="pre">RandomForest</span></code>), podemos establecer ese paso como <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;classifier&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">SVC</span><span class="p">()],</span> <span class="s1">&#39;preprocessing&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="kc">None</span><span class="p">],</span>
               <span class="s1">&#39;classifier__gamma&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
               <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]},</span>
              <span class="p">{</span><span class="s1">&#39;classifier&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)],</span>
               <span class="s1">&#39;preprocessing&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;classifier__max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}]</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ahora podemos instanciar y ejecutar la búsqueda en la red como de costumbre, aquí en el conjunto de datos <code class="docutils literal notranslate"><span class="pre">cancer</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">cancer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cancer</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best params:</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_params_</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best cross-validation score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_score_</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best params:
{&#39;classifier&#39;: SVC(C=10, gamma=0.01), &#39;classifier__C&#39;: 10, &#39;classifier__gamma&#39;: 0.01, &#39;preprocessing&#39;: StandardScaler()}

Best cross-validation score: 0.99
Test-set score: 0.98
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>El resultado de la búsqueda en la red es que el <code class="docutils literal notranslate"><span class="pre">SVC</span></code> con el preprocesamiento <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code>, <code class="docutils literal notranslate"><span class="pre">C=10</span></code> y <code class="docutils literal notranslate"><span class="pre">gamma=0.01</span></code> dio el mejor resultado.</p></li>
</ul>
</section>
<section id="resumen-y-conclusiones">
<h2>Resumen y conclusiones<a class="headerlink" href="#resumen-y-conclusiones" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>En este capítulo hemos introducido la clase <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code>, una herramienta de propósito general para encadenar para encadenar múltiples pasos de procesamiento en un flujo de trabajo de aprendizaje automático. Las aplicaciones del mundo real del aprendizaje automático rara vez implican un uso aislado de un modelo, y en su lugar son una secuencia de pasos de procesamiento. El uso de <code class="docutils literal notranslate"><span class="pre">pipelines</span></code> nos permite encapsular múltiples pasos en un solo objeto de <code class="docutils literal notranslate"><span class="pre">Python</span></code> que se adhiere a la interfaz familiar de <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> de ajustar, predecir y transformar. En particular, cuando se realiza la evaluación del modelo mediante la validación cruzada y la selección de parámetros mediante la búsqueda en red, el uso de la clase <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> para captar todos los pasos de procesamiento es esencial para una evaluación adecuada.</p></li>
<li><p>La clase <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> también permite escribir un código más resumido, y reduce la probabilidad de errores que pueden ocurrir al construir cadenas de procesamiento sin la clase <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> (como olvidar de aplicar todos los transformadores en el conjunto de pruebas, o no aplicarlos en el orden correcto). La elección de la combinación correcta de extracción de características, preprocesamiento y modelos es un arte, y a menudo requiere un poco de ensayo y error.  Sin embargo, utilizando <code class="docutils literal notranslate"><span class="pre">pipelines</span></code>, este “ensayo” de muchos pasos de procesamiento diferentes es bastante sencillo. Cuando experimenta su uso, tenga cuidado de no complicar demasiado sus procesos y asegúrese de evaluar si todos los componentes que se incluyen en el modelo son necesarios.</p></li>
<li><p>Con este capítulo, hemos completado nuestro estudio de las herramientas de propósito general y los algoritmos proporcionados por <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>. Ahora posee todas las habilidades requeridas y conoce los mecanismos necesarios para aplicar el aprendizaje automático en la práctica. En el próximo capítulo, profundizaremos en un tipo particular de datos que se ve comúnmente en la práctica, y que requiere cierta experiencia especial para manejarse correctamente: <code class="docutils literal notranslate"><span class="pre">los</span> <span class="pre">datos</span> <span class="pre">de</span> <span class="pre">texto</span></code>.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="model_evaluation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Evaluación de modelos</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="unsupervised_learning.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Aprendizaje de maquinas no supervisado</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Lihki Rubio y Carlos de Oro<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>